{% extends "layout.html" %}
{% block footer_scripts %}
<script type="text/javascript">
	$(document).ready(function() {   
		var shotsTable = $('#shots').dataTable({
			"bProcessing": true,
			"iDisplayLength": 25,
			"aaData": {{ entries | safe }},
			"aoColumns": [
				{ "bSortable": false },
			    null,
			    null,
			    null,
			    null
			],

			"fnRowCallback": function( nRow, aData, iDisplayIndex, iDisplayIndexFull ) {
				var btn_status = "";
				if (aData[3] == "offline"){
					$('td:eq(3)', nRow).html('<span class="label label-important">offline</apn>');
					btn_status = "disabled";
				} else if (aData[3] == "online"){
					$('td:eq(3)', nRow).html('<span class="label label-success">online</apn>');
				}

				if (aData[4] == "enabled"){
					$('td:eq(4)', nRow).html('<span class="status-toggle btn btn-mini btn-success ' + btn_status + '">enabled</span>');
				} else if (aData[4] == "disabled"){
					$('td:eq(4)', nRow).html('<span class="status-toggle btn btn-mini btn-warning ' + btn_status + '">disabled</span>');
				}

				$('td:eq(2)', nRow).html('<div class="progress"><div class="bar" style="width: ' + aData[2] + '%;"></div></div>');
	    	}
		});

		$(document).on("click", ".status-toggle", function() {
			var status = $(this).html();
			var tableRow = $(this).parents("tr");
			var rowPosition = shotsTable.fnGetPosition(tableRow[0]);
			var clientId = tableRow.attr("id").split("_")[1];

			if (status == 'enabled') {
				query = 'item=client&action=update&filters={"id":' + clientId +'}&values={"status":"disabled"}' ;
				$.getJSON('ajax/test.json', query, function() {
					console.log('Worker is now disabled');
					shotsTable.fnUpdate('disabled', rowPosition ,4);
				});
			} else if (status == 'disabled') {
				query = 'item=client&action=update&filters={"id":' + clientId +'}&values={"status":"enabled"}' ;
				$.getJSON('ajax/test.json', query, function() {
					console.log('Worker is now enabled');
					shotsTable.fnUpdate('enabled', rowPosition ,4);
				});
			}
		});

	});
</script>
{% endblock %}
{% block body %}
	<div class="page-header">
	    <h1>Shots</h1>
	</div>
	<div class="row">
		<div class="span10">
			<div id="clients-disable-all" class="btn btn-warning">Disable All</div>
			<div id="clients-enable-all" class="btn btn-success">EnableAll</div>
		</div>
	</div>
	<hr>
	<div class="row">
		<div class="span10">
			<table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered" id="shots">
				<thead>
					<tr>
						<th width="5%"><input type="checkbox"></th>
						<th width="30%">Shot (thumbnail)</th>
						<th width="30%">Completion</th>
						<th width="20%">Configuration</th>
						<th width="20%">Status</th>
					</tr>
				</thead>
				<tbody>

				</tbody> 
				<tfoot>
					<tr>
						<th></th>
						<th>Shot</th>
						<th>IP Address</th>
						<th>Connection</th>
						<th>Status</th>
					</tr>
				</tfoot>
			</table>	
		</div>
	</div>

{% endblock %}